# MicroPython SSD1309 OLED 驱动使用说明

本文档为 `ssd1309.py` 驱动程序提供说明，旨在帮助开发者（和AI助手）理解和使用此模块。该驱动用于在 MicroPython 环境下，通过 I2C 或 SPI 协议与 SSD1309 OLED 显示屏进行通信。

## 核心工作流程

1.  **导入模块**: 导入 `machine` 模块的相关类 (`Pin`, `I2C`, `SPI`) 以及 `ssd1309` 驱动。
2.  **初始化总线**: 根据硬件连接，正确配置并实例化 I2C 或 SPI 总线。
3.  **实例化驱动**:
    *   I2C 接口: 创建 `ssd1309.SSD1309_I2C` 类的实例。
    *   SPI 接口: 创建 `ssd1309.SSD1309_SPI` 类的实例。
4.  **执行绘图**: 调用驱动实例的绘图方法（如 `text()`, `rect()`, `line()` 等）。所有绘图操作都在内存中的帧缓冲区 (`framebuf`) 中进行，不会立即显示。
5.  **显示内容**: 调用 `display.show()` 方法，将帧缓冲区的数据一次性发送到 OLED 屏幕上进行物理显示。

---

## 使用示例

### I2C 接口示例

这是项目 `main.py` 中使用的标准方法。

```python
from machine import Pin, I2C
import ssd1309
import time

# 1. 初始化I2C总线 (请根据实际接线修改 scl 和 sda 引脚)
i2c = I2C(0, scl=Pin(22), sda=Pin(21))

# 2. 实例化驱动 (参数: 宽度, 高度, i2c实例)
display = ssd1309.SSD1309_I2C(128, 64, i2c)

# 3. 绘图操作
display.fill(0)  # 清屏 (0=黑, 1=白)
display.text("Hello, World!", 0, 0, 1) # 绘制文字
display.rect(0, 10, 64, 20, 1) # 绘制矩形

# 4. 推送至屏幕显示
display.show()

time.sleep(2)

# 其他功能：反转颜色
display.invert(True)
```

### SPI 接口示例

使用 SPI 接口时，需要额外定义 `dc` (Data/Command), `res` (Reset), 和 `cs` (Chip Select) 引脚。

```python
from machine import Pin, SPI
import ssd1309
import time

# 1. 初始化SPI总线和控制引脚 (请根据实际接线修改)
spi = SPI(1, baudrate=10000000, sck=Pin(18), mosi=Pin(23))
dc_pin = Pin(19, Pin.OUT)
res_pin = Pin(5, Pin.OUT)
cs_pin = Pin(17, Pin.OUT)

# 2. 实例化驱动 (参数: 宽度, 高度, spi实例, dc, res, cs 引脚)
display = ssd1309.SSD1309_SPI(128, 64, spi, dc_pin, res_pin, cs_pin)

# 3. 绘图操作
display.fill(0)
display.text("Hello, SPI!", 0, 0, 1)

# 4. 推送至屏幕显示
display.show()
```

---

## 主要API参考

该驱动的绘图方法基于 MicroPython 内置的 `framebuf` 模块。

*   `display.show()`: **[关键]** 将缓冲区内容更新到屏幕。
*   `display.fill(c)`: 用颜色 `c` (0-黑, 1-白) 填充整个屏幕。
*   `display.pixel(x, y, c)`: 在坐标 `(x, y)` 处用颜色 `c` 绘制一个像素。
*   `display.text(string, x, y, c=1)`: 在坐标 `(x, y)` 处显示字符串。
*   `display.line(x1, y1, x2, y2, c)`: 绘制一条从 `(x1, y1)` 到 `(x2, y2)` 的线。
*   `display.hline(x, y, width, c)`: 绘制水平线。
*   `display.vline(x, y, height, c)`: 绘制垂直线。
*   `display.rect(x, y, width, height, c, f=False)`: 绘制矩形。若 `f=True` 则填充。
*   `display.invert(True/False)`: 翻转显示颜色（黑变白，白变黑）。
*   `display.contrast(value)`: 设置屏幕对比度 (0-255)。
*   `display.poweron() / display.poweroff()`: 打开/关闭屏幕电源。
